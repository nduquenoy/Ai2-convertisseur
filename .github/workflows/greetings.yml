name: ğŸ‰ Interaction & Remerciements

on:
  issues:
    types: [opened, closed, reopened]
  pull_request_target:
    types: [opened, closed, reopened]
  push:
    branches: [main]
  discussion:
    types: [created]

jobs:
  greetings:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      pull-requests: write
      discussions: write

    steps:
    - name: ğŸ¤– Message de bienvenue (premiÃ¨re interaction)
      uses: actions/first-interaction@v1
      with:
        repo-token: ${{ secrets.GITHUB_TOKEN }}
        issue-message: |
          ## ğŸ‘‹ Bonjour ${{ github.actor }} !
          Je suis **Nicolas**, le fondateur de **La MalÃ©diction du Village**.

          Aujourd'hui est un grand jour : tu as publiÃ© ta **premiÃ¨re issue** ğŸ¾ !

          Je te remercie donc de contribuer a ce projet, **La MalÃ©diction du Village** !
          Ton aide nous est prÃ©cieuse pour l'amÃ©lioration.

          Nâ€™hÃ©site pas Ã  participer Ã  la discussion ou Ã  proposer des amÃ©liorations.

          â€” *Nicolas*
        pr-message: |
          ## ğŸ‘‹ Salut ${{ github.actor }} !  
          Merci pour ta **premiÃ¨re Pull Request** sur *La MalÃ©diction du Village*.
          
          Ton implication aide rÃ©ellement Ã  faire grandir le projet.  
          Si tu veux, rejoins-nous sur le Discord communautaire pour Ã©changer !

          â€” *Nicolas*

  thanks:
    runs-on: ubuntu-latest
    if: github.event_name == 'push' || github.event_name == 'pull_request_target'
    permissions:
      contents: write  # ğŸ‘ˆ autorise la crÃ©ation de commentaires sur les commits
    steps:
    - name: ğŸ™Œ Remercier pour les contributions
      uses: peter-evans/commit-comment@v3
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        body: |
          ğŸ‘ Merci **${{ github.actor }}** pour ta contribution !
          Chaque commit compte, et ton travail sur *La MalÃ©diction du Village* est apprÃ©ciÃ© ğŸ’«
          
          Continue comme Ã§a, aventurier du code ğŸº
  labeler:
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request_target'
    permissions:
      contents: write  # ğŸ‘ˆ autorise la crÃ©ation de commentaires sur les commits
    steps:
    - name: ğŸ·ï¸ Ajouter des labels automatiques
      uses: actions-ecosystem/action-add-labels@v1
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        labels: |
          contribution
          en-attente-revue

  pr-merge-message:
    runs-on: ubuntu-latest
    if: github.event.pull_request.merged == true
    permissions:
      contents: write  # ğŸ‘ˆ autorise la crÃ©ation de commentaires sur les commits
    steps:
    - name: ğŸŠ FÃ©liciter pour la fusion de PR
      uses: actions/github-script@v7
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: |
          const pr = context.payload.pull_request;
          const user = pr.user.login;
          const message = `ğŸ‰ Bravo @${user} ! Ta Pull Request **${pr.title}** vient dâ€™Ãªtre fusionnÃ©e dans *La MalÃ©diction du Village* ğŸ¡  
          Merci pour ton travail et ta contribution Ã  ce projet magique âœ¨`;
          await github.issues.createComment({
            issue_number: pr.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: message
          });
